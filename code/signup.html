<!DOCTYPE html>
<html>
<link type="text/css" rel="stylesheet" href="https://cdn.firebase.com/libs/firebaseui/3.5.2/firebaseui.css" />

<head>
    <title>Signup Page</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u"
        crossorigin="anonymous">
        <script>
                fieldValid = false;
                passWordValid = false;
                zipCodeValid = false;
            
                fieldArray = [];
            
              /*
                * AUTH Function  by Jason Ngov
                * a) Parameters/Inputs: email, password
                * b) Output Value: Two Cases
                *      - If the credentials are valid and successful
                *          Returns to console a user-generated ID, "Account creation has been sucessful", and "Email Sent"
                *          Alerts user to "Please check your email for email verification and sign in" 
                *      - If there is an error
                *          Alerts user of errors and does not log user into Firebase authentication and database
                * c) Descriptions: 
                *      - Authenticates user and creates a profile in Firebase authentication
                *      - Loads user information (first, last, email, zipcode) into Firebase collection named 'Users', unique document ID matches with generated login ID
                * d) Preconditions:
                *      - Email and passwords must be valid. Email and password would not reach authentication function
                *        if there was a faulty email or password, and would prompt user for a better email or password 
                *        before running this auth function
                *      - If these variables are satisfied but there is a badly formatted email, or short password, Firebase error message will step in and alert the user
                * e) Postconditions:
                *      - Outputs unique userID and prompts user for email verification
              */  
                function checkPasswords() {
                  password = document.getElementById("password").value;
                  confirmedPassword = document.getElementById("confirmedPassword").value;
                  if (password != confirmedPassword && password.length > 0) {
                    document.getElementById("passwordStatus").style.color = "#FA676C";
                    document.getElementById("passwordStatus").innerHTML =
                      "Passwords do not match";
                    passWordValid = false;
                  } else if (password == confirmedPassword && password.length > 0) {
                    document.getElementById("passwordStatus").style.color = "#71D79A";
                    document.getElementById("passwordStatus").innerHTML =
                      "Passwords match!";
                    passWordValid = true;
                  } else if (password == "") {
                    //Special case for when password field is cleared
                    document.getElementById("passwordStatus").style.color = "#FA676C";
                    document.getElementById("passwordStatus").innerHTML =
                      "Passwords do not match";
                    passWordValid = false;
                  }
                }
                /*
                 * Checks each field if empty, changes fieldValid to true if all fields are filled
                 * Firebase functionality in auth.js will not be called until fieldValid = true
                 */
                function checkFields() {
                  form = document.getElementById("signup-form");
                  var i;
                  for (i = 0; i < form.length - 1; i++) {
                    fieldArray[i] = form[i].value;
                  }
                  fieldValid = fieldArray.every(isNotEmpty);
                 // console.log("Fields filled: ", fieldValid);
                }
                /*
                 * Returns true if string is not empty
                 */
                function isNotEmpty(newStr) {
                  return newStr != "";
                }
        </script>    
</head>
<body>
    <div class="container" style="width: 50%;">
        <div class="image-holder">
            <img class="center-block" src="triangle.png" style="width: 200px; height: 200px">
        </div>
        <form id="signup-form">
            <div class="form-group">
                <label>First</label>
                <input type="text" class="form-control" id="first" placeholder="First" required>
            </div>
            <div class="form-group">
                <label>Last</label>
                <input type="text" class="form-control" id="last" placeholder="Last" required>
            </div>
            <div class="form-group">
                <label>Email address</label>
                <input type="email" class="form-control" id="email" placeholder="Email" required>
            </div>
            <div class="form-group">
                <label>Password</label>
                <input type="password" class="form-control" id="password" placeholder="Password" onkeyup = "checkPassswords();">
            </div>
            <div class="form-group">
                <label>Confirm Password</label>
                <div style="display: inline">
                    <input type="password" class="form-control" id="confirmedPassword" placeholder="Confirm Password"
                        onkeyup = "checkPasswords()" required> </div>
                <span id="passwordStatus"></span>
            </div>
            <button type="submit" class="center-block btn btn-lg btn-primary btn-block" id="joinbtn" style="margin-bottom: 25px"
                onclick="checkFields()">Join Now</button>
        </form>
    </div>
    <script src="https://www.gstatic.com/firebasejs/5.9.2/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/5.9.2/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/5.9.2/firebase-firestore.js"></script>

    <script>
        // Initialize Firebase
        var firebaseConfig = {
            apiKey: "AIzaSyBZJvMVi_elOmLAwUb8fpqjrKCFlQmEspg",
            authDomain: "gpacalculator-1f0b4.firebaseapp.com",
            databaseURL: "https://gpacalculator-1f0b4.firebaseio.com",
            projectId: "gpacalculator-1f0b4",
        };
        firebase.initializeApp(firebaseConfig);

        //create auth reference
        const auth = firebase.auth();
        const db = firebase.firestore();
    </script>
    <script src="auth.js"></script>
</body>

</html>